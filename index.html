<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Professional camera app for survey and field work with GPS, compass, and sensor integration">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://unpkg.com; style-src 'self' 'unsafe-inline'; img-src 'self' blob: data:; font-src 'self' data: https:; connect-src 'self' https://nominatim.openstreetmap.org https://geocode.maps.co https://api.open-meteo.com; worker-src 'self'; manifest-src 'self'">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="sec-lens-logo.png">
    <link rel="apple-touch-icon" href="sec-lens-logo.png">
    <title>LIGHT LENS - Survey Camera</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Camera View -->
    <div id="camera-view">
        <video id="video" autoplay playsinline muted aria-label="Camera live view"></video>
    </div>

    <!-- Flash Effect -->
    <div id="flash" aria-hidden="true"></div>
    
    <!-- Focus Ring -->
    <div id="focus-ring" aria-hidden="true"></div>
    
    <!-- Grid Overlay -->
    <div id="grid-overlay" class="active" aria-hidden="true">
        <div class="grid-line vertical" style="left: 33.33%"></div>
        <div class="grid-line vertical" style="left: 66.66%"></div>
        <div class="grid-line horizontal" style="top: 33.33%"></div>
        <div class="grid-line horizontal" style="top: 66.66%"></div>
    </div>

    <!-- Level Indicator -->
    <div id="level-indicator" aria-hidden="true">
        <div class="level-line"></div>
        <div class="level-center"></div>
    </div>
    
    <!-- Timer Countdown -->
    <div id="timer-countdown" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Burst Mode Indicator -->
    <div id="burst-indicator" aria-live="polite">
        ğŸ“¸ Burst Mode: <span class="burst-counter">0/10</span>
    </div>
    
    <!-- Status Messages -->
    <div id="status-msg" role="alert" aria-live="polite"></div>
    
    <!-- Top Bar -->
    <div id="topbar" role="banner" aria-label="App header">
        <div class="topbar-left">
            <img src="sec-lens-logo.png" alt="Lens Light Logo" class="app-logo" width="42" height="42">
            <div class="topbar-text">
                <div class="app-title">Lens Light</div>
                <div class="app-subtitle">Survey capture</div>
            </div>
        </div>
        <div class="topbar-right">
            <span class="pill warning" id="battery-mode-indicator" style="display:none;" aria-label="Battery Saving Mode">ğŸ”‹ SAVER</span>
            <span class="pill" id="ui-badge">LIVE</span>
        </div>
    </div>

    <!-- Permission Button -->
    <button id="ios-perm-btn" aria-label="Enable camera and sensors">ğŸ¥ Enable Camera & Sensors</button>

    <!-- UI Overlay Layer -->
    <div class="ui-layer">
        <!-- Compass -->
        <div id="compass-container" role="img" aria-label="Compass showing north direction">
            <div class="compass-label n" aria-hidden="true">N</div>
            <div class="compass-label s" aria-hidden="true">S</div>
            <div class="compass-label e" aria-hidden="true">E</div>
            <div class="compass-label w" aria-hidden="true">W</div>
            <div id="compass-arrow" aria-hidden="true"></div>
        </div>
        
        <!-- Weather Info -->
        <div id="weather-info" role="complementary" aria-label="Weather information"></div>

        <!-- Map Placeholder (Hidden) -->
        <div id="map-placeholder" aria-hidden="true">
            ğŸ“ GPS Position
            <div id="map-dot"></div>
        </div>

        <!-- Data Container -->
        <div id="data-container" role="complementary" aria-label="Location and sensor data">
            <div class="data-line small-text" id="date-time">--/--/---- --:--:--</div>
            <div class="data-line large-text" id="gps-coords">WAITING FOR GPS...</div>
            <div class="data-line small-text" id="location-name">Location: Unknown</div>
            <div class="data-line small-text" id="altitude">Alt: -- m</div>
            <div class="data-line small-text" id="heading-text">Heading: --Â°</div>
            <div class="data-line small-text" id="gps-accuracy">Accuracy: --</div>
        </div>

        <!-- Zoom Controls -->
        <div id="zoom-controls" role="group" aria-label="Zoom controls">
            <button class="zoom-btn" id="zoom-in" aria-label="Zoom in" type="button">+</button>
            <button class="zoom-btn" id="zoom-out" aria-label="Zoom out" type="button">âˆ’</button>
        </div>
        
        <!-- Feature Controls -->
        <div id="feature-controls" role="toolbar" aria-label="Camera features">
            <button class="feature-btn active" id="grid-btn" title="Grid Overlay" aria-label="Toggle grid overlay" aria-pressed="true" type="button">âŠ</button>
            <button class="feature-btn" id="level-btn" title="Level Indicator" aria-label="Toggle level indicator" aria-pressed="false" type="button">âš–ï¸</button>
            <button class="feature-btn" id="timer-btn" title="Self Timer" aria-label="Self timer options" aria-haspopup="true" aria-expanded="false" type="button">â±ï¸</button>
            <button class="feature-btn" id="flashlight-btn" title="Flashlight" aria-label="Toggle flashlight" aria-pressed="false" type="button">ğŸ”¦</button>
            <button class="feature-btn" id="filter-btn" title="Filters" aria-label="Photo filters" aria-haspopup="true" aria-expanded="false" type="button">ğŸ¨</button>
            <button class="feature-btn" id="exposure-btn" title="Exposure" aria-label="Exposure control" aria-pressed="false" type="button">â˜€ï¸</button>
            <button class="feature-btn" id="burst-btn" title="Burst Mode" aria-label="Toggle burst mode" aria-pressed="false" type="button">ğŸ“¸</button>
            <button class="feature-btn" id="focus-btn" title="Tap to Focus" aria-label="Enable tap to focus" aria-pressed="false" type="button">ğŸ¯</button>
            <button class="feature-btn" id="wb-btn" title="White Balance" aria-label="White balance control" aria-pressed="false" type="button">ğŸŒ¡ï¸</button>
            <button class="feature-btn" id="hdr-btn" title="HDR Mode" aria-label="Toggle HDR mode" aria-pressed="false" type="button">âœ¨</button>
            <button class="feature-btn" id="qr-btn" title="QR Scanner" aria-label="Open QR code scanner" type="button">âŠ¡</button>
        </div>

        <!-- Timer Menu -->
        <div id="timer-menu" role="menu" aria-label="Timer options">
            <div class="timer-option selected" data-time="0" role="menuitemradio" aria-checked="true" tabindex="0">Off</div>
            <div class="timer-option" data-time="3" role="menuitemradio" aria-checked="false" tabindex="-1">3 sec</div>
            <div class="timer-option" data-time="5" role="menuitemradio" aria-checked="false" tabindex="-1">5 sec</div>
            <div class="timer-option" data-time="10" role="menuitemradio" aria-checked="false" tabindex="-1">10 sec</div>
        </div>
        
        <!-- Filter Menu -->
        <div id="filter-menu" role="menu" aria-label="Filter options">
            <div class="filter-option selected" data-filter="normal" role="menuitemradio" aria-checked="true" tabindex="0">Normal</div>
            <div class="filter-option" data-filter="bw" role="menuitemradio" aria-checked="false" tabindex="-1">B&W</div>
            <div class="filter-option" data-filter="sepia" role="menuitemradio" aria-checked="false" tabindex="-1">Sepia</div>
            <div class="filter-option" data-filter="vintage" role="menuitemradio" aria-checked="false" tabindex="-1">Vintage</div>
            <div class="filter-option" data-filter="vivid" role="menuitemradio" aria-checked="false" tabindex="-1">Vivid</div>
        </div>
        
        <!-- Exposure Control -->
        <div id="exposure-control" role="group" aria-label="Exposure adjustment">
            <span class="exposure-label" aria-hidden="true">â˜€ï¸</span>
            <input type="range" id="exposure-slider" min="-2" max="2" step="0.1" value="0" aria-label="Exposure compensation" aria-valuemin="-2" aria-valuemax="2" aria-valuenow="0">
            <span class="exposure-label" aria-hidden="true">ğŸŒ™</span>
        </div>
        
        <!-- White Balance Control -->
        <div id="wb-control" role="group" aria-label="White balance adjustment">
            <span class="wb-label" aria-hidden="true">ğŸ”µ</span>
            <input type="range" id="wb-slider" min="2000" max="8000" step="100" value="5500" aria-label="Color temperature" aria-valuemin="2000" aria-valuemax="8000" aria-valuenow="5500">
            <span class="wb-label" aria-hidden="true">ğŸŸ </span>
        </div>
    </div>

    <!-- Main Controls -->
    <div id="controls" role="toolbar" aria-label="Main camera controls">
        <button id="gallery-btn" aria-label="Open gallery" type="button">
            ğŸ“·
            <span id="photo-count" style="display: none;" aria-label="Photo count">0</span>
        </button>
        <button id="shutter-btn" aria-label="Take photo" type="button" class="disabled"></button>
        <button id="settings-btn" aria-label="Settings" type="button">âš™ï¸</button>
        <button id="flip-camera-btn" title="Switch Camera" aria-label="Switch camera" type="button">ğŸ”„</button>
        <button id="share-btn" aria-label="Share photo" type="button">ğŸ“¤</button>
        <input type="file" id="file-input" accept="image/*" style="display: none;" aria-hidden="true">
    </div>

    <!-- Settings Panel -->
    <div id="settings-panel" role="dialog" aria-labelledby="settings-title" aria-hidden="true">
        <div class="settings-header">
            <h2 id="settings-title">âš™ï¸ Settings</h2>
            <button class="close-btn" id="close-settings" aria-label="Close settings" type="button">Close</button>
        </div>
        
        <div class="setting-item">
            <label for="project-name" id="label-project-name">ğŸ“ Project Name</label>
            <input type="text" id="project-name" placeholder="e.g., Site Survey 2025" aria-describedby="label-project-name">
        </div>

        <div class="setting-item">
            <label for="custom-location" id="label-custom-location">ğŸ“ Custom Location Tag</label>
            <input type="text" id="custom-location" placeholder="e.g., Riyadh Province" aria-describedby="label-custom-location">
        </div>

        <div class="setting-item">
            <label for="units-select" id="label-units">ğŸ“ Units</label>
            <select id="units-select" aria-describedby="label-units">
                <option value="metric">Metric (meters)</option>
                <option value="imperial">Imperial (feet)</option>
            </select>
        </div>
        
        <div class="setting-item">
            <label for="language-select" id="label-language">ğŸŒ Language / Ø§Ù„Ù„ØºØ©</label>
            <select id="language-select" aria-describedby="label-language">
                <option value="en">English</option>
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            </select>
        </div>

        <div class="setting-item">
            <label style="display: flex; justify-content: space-between; align-items: center;">
                <span id="label-show-compass">ğŸ—ºï¸ Show Compass Overlay</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-compass" checked aria-label="Show compass overlay">
                    <span class="slider"></span>
                </label>
            </label>
        </div>

        <div class="setting-item">
            <label style="display: flex; justify-content: space-between; align-items: center;">
                <span id="label-show-data">ğŸ“Š Show Data Overlay</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-data" checked aria-label="Show data overlay">
                    <span class="slider"></span>
                </label>
            </label>
        </div>

        <div class="setting-item">
            <label for="quality-select" id="label-image-quality">ğŸ“¸ Image Quality</label>
            <select id="quality-select" aria-describedby="label-image-quality">
                <option value="1.0" selected>High (100%)</option>
                <option value="0.9">Medium (90%)</option>
                <option value="0.8">Low (80%)</option>
            </select>
        </div>
        
        <div class="setting-item">
            <label style="display: flex; justify-content: space-between; align-items: center;">
                <span id="label-watermark">ğŸ’§ Add Watermark (GPS/Time)</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-watermark" aria-label="Add watermark">
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="setting-item">
            <label style="display: flex; justify-content: space-between; align-items: center;">
                <span id="label-camera-sound">ğŸ”Š Camera Sound</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-sound" checked aria-label="Camera sound">
                    <span class="slider"></span>
                </label>
            </label>
        </div>

        <div class="setting-item">
            <label style="display: flex; justify-content: space-between; align-items: center;">
                <span id="label-battery-mode">ğŸ”‹ Battery Saver</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-battery" aria-label="Battery saver mode">
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="setting-item">
            <label for="timestamp-format" id="label-timestamp">ğŸ• Timestamp Format</label>
            <select id="timestamp-format" aria-describedby="label-timestamp">
                <option value="iso">ISO 8601 (2026-01-15T10:30:00)</option>
                <option value="us">US (01/15/2026 10:30 AM)</option>
                <option value="eu">EU (15/01/2026 10:30)</option>
                <option value="arabic">Arabic (Ù¡Ù¥/Ù Ù¡/Ù¢Ù Ù¢Ù¦)</option>
            </select>
        </div>
        
        <div class="setting-item">
            <label style="display: flex; justify-content: space-between; align-items: center;">
                <span id="label-hdr">âœ¨ HDR Mode</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-hdr" aria-label="HDR mode">
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="setting-item">
            <label style="display: flex; justify-content: space-between; align-items: center;">
                <span id="label-focus-assist">ğŸ¯ Focus Assist</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-focus-assist" checked aria-label="Focus assist">
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="setting-item">
            <label style="display: flex; justify-content: space-between; align-items: center;">
                <span id="label-debug-mode">ğŸ› Debug Logging (Console)</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggle-debug-mode" aria-label="Debug logging">
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="setting-item" style="border-bottom: none;">
            <button class="clear-data-btn" id="clear-all-data-btn" type="button">
                <span id="label-clear-data">ğŸ—‘ï¸ Clear All Data</span>
            </button>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="gallery-modal" role="dialog" aria-labelledby="gallery-title" aria-hidden="true">
        <div class="gallery-header">
            <h2 id="gallery-title">ğŸ“· Gallery (<span id="gallery-count">0</span>)</h2>
            <div style="display: flex; gap: 8px;">
                <button class="action-btn" id="select-mode-btn" style="display: none;" type="button">Select</button>
                <button class="close-btn" id="close-gallery" aria-label="Close gallery" type="button">Close</button>
            </div>
        </div>
        <div class="gallery-actions" id="gallery-actions" style="display: none;" role="toolbar" aria-label="Gallery actions">
            <button class="action-btn" id="select-all-btn" type="button">Select All</button>
            <button class="action-btn" id="share-selected-btn" type="button">ğŸ“¤ Share Selected</button>
            <button class="action-btn" id="download-selected-btn" type="button">ğŸ’¾ Save Selected</button>
            <button class="action-btn" id="delete-selected-btn" type="button">ğŸ—‘ï¸ Delete Selected</button>
            <button class="action-btn" id="compare-photos-btn" type="button" disabled>ğŸ” Compare (2)</button>
            <button class="action-btn" id="export-metadata-btn" type="button">ğŸ“Š Export Metadata</button>
            <button class="action-btn" id="cancel-select-btn" type="button">Cancel</button>
        </div>
        <div class="gallery-grid" id="gallery-grid" role="list" aria-label="Photo gallery"></div>
    </div>

    <!-- QR Scanner -->
    <div id="qr-scanner" role="dialog" aria-labelledby="qr-scanner-title" aria-hidden="true">
        <div class="gallery-header">
            <h2 id="qr-scanner-title">âŠ¡ QR Code Scanner</h2>
            <button class="close-btn" id="close-qr-scanner" aria-label="Close QR scanner" type="button">Close</button>
        </div>
        <div id="qr-scanner-viewport">
            <canvas id="qr-canvas" style="display:none;"></canvas>
            <div class="qr-scan-frame"></div>
            <div id="qr-result" style="display:none;"></div>
        </div>
    </div>

    <!-- Photo Comparison Mode -->
    <div id="comparison-mode" role="dialog" aria-labelledby="comparison-title" aria-hidden="true">
        <div class="gallery-header">
            <h2 id="comparison-title">ğŸ” Compare Photos</h2>
            <button class="close-btn" id="close-comparison" aria-label="Close comparison" type="button">Close</button>
        </div>
        <div class="comparison-container">
            <div class="comparison-photo" id="comparison-left">
                <img alt="First photo" />
                <div class="photo-label">Photo 1</div>
            </div>
            <div class="comparison-divider"></div>
            <div class="comparison-photo" id="comparison-right">
                <img alt="Second photo" />
                <div class="photo-label">Photo 2</div>
            </div>
        </div>
    </div>

    <!-- Photo Viewer -->
    <div id="photo-viewer" role="dialog" aria-labelledby="photo-viewer-title" aria-hidden="true">
        <div class="gallery-header">
            <h2 id="photo-viewer-title">ğŸ–¼ï¸ Photo</h2>
            <div style="display: flex; gap: 8px;">
                <button class="close-btn" id="close-photo-viewer" aria-label="Close photo viewer" type="button">Close</button>
            </div>
        </div>
        <div class="photo-viewer-body">
            <img id="photo-viewer-img" alt="Photo preview" />
            <div id="photo-viewer-comment" style="display:none; padding-top: 10px; font-size: 14px; color: var(--text-dim);"></div>
        </div>
        <div class="photo-viewer-actions" role="toolbar" aria-label="Photo actions">
            <button class="action-btn" id="viewer-share-btn" type="button">ğŸ“¤ Share</button>
            <button class="action-btn" id="viewer-save-btn" type="button">ğŸ’¾ Save</button>
            <button class="action-btn" id="viewer-comment-btn" type="button">ğŸ’¬ Comment</button>
            <button class="action-btn" id="viewer-delete-btn" type="button">ğŸ—‘ï¸ Delete</button>
        </div>
    </div>

    <!-- Hidden Canvas for Image Processing -->
    <canvas id="hidden-canvas" style="display:none;" aria-hidden="true"></canvas>

    <!-- QR Code Scanner Library -->
    <!-- Using unpkg.com instead of jsdelivr to avoid tracking prevention blocks -->
    <script src="https://unpkg.com/jsqr@1.4.0/dist/jsQR.js" defer></script>

    <script type="module" src="js/main.js" defer></script>
</body>
</html>
